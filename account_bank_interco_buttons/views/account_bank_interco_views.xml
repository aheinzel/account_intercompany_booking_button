<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <record id="view_bank_statement_line_form_inherit_interco" model="ir.ui.view">
    <field name="name">account.bank.statement.line.form.interco</field>
    <field name="model">account.bank.statement.line</field>
    <field name="inherit_id" ref="account.view_bank_statement_form"/>
    <field name="arch" type="xml">
      <xpath expr="//button[@name='process_reconciliation']" position="after">
        <button name="action_open_interco_allocate_wizard"
                type="object"
                string="Inter-co allocate"
                class="btn-primary"
                attrs="{'invisible': [('state','=','reconciled')]}"/>
      </xpath>
      <xpath expr="//sheet/notebook" position="inside">
        <page string="Intercompany">
          <field name="interco_move_ids" widget="many2many_tags"/>
        </page>
      </xpath>
    </field>
  </record>

  <record id="view_interco_allocate_wizard_form" model="ir.ui.view">
    <field name="name">interco.allocate.wizard.form</field>
    <field name="model">interco.allocate.wizard</field>
    <field name="arch" type="xml">
      <form string="Intercompany Allocation">
        <sheet>
          <group>
            <group>
              <field name="statement_line_id" readonly="1"/>
              <field name="amount"/>
              <field name="currency_id"/>
              <field name="ref_text" placeholder="e.g., Billa Einkauf 2025-08-26 / Split"/>
            </group>
            <group>
              <field name="reconcile_mode"/>
              <field name="clearing_account_id"/>
              <field name="attach_file" filename="attach_filename"/>
              <field name="attach_filename"/>
            </group>
          </group>

          <notebook>
            <page string="Allocations">
              <field name="line_ids">
                <tree editable="bottom">
                  <field name="company_id"/>
                  <field name="percent"/>
                  <field name="src_expense_account_id"/>
                  <field name="src_interco_ar_account_id"/>
                  <field name="src_journal_id"/>
                  <field name="dst_expense_account_id"/>
                  <field name="dst_interco_ap_account_id"/>
                  <field name="dst_journal_id"/>
                </tree>
              </field>
            </page>
          </notebook>
        </sheet>
        <footer>
          <button string="Create moves" type="object" name="action_create_moves" class="btn-primary"/>
          <button string="Cancel" class="btn-secondary" special="cancel"/>
        </footer>
      </form>
    </field>
  </record>
</odoo>